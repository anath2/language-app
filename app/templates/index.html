<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Application CSS -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/segments.css">
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8 flex items-start justify-between">
            <div>
                <h1 class="font-chinese font-semibold mb-1" style="color: var(--text-primary); font-size: var(--text-2xl);">
                    Language App
                </h1>
                <p style="color: var(--text-secondary); font-size: var(--text-base);">
                    Enter Chinese text to get word segmentation, pinyin, and English translation
                </p>
            </div>
            <div class="flex items-center gap-3">
                <a href="/translations" class="btn-secondary px-3 py-1.5 text-sm">Translations</a>
                <a href="/admin" class="btn-secondary px-3 py-1.5 text-sm">Admin</a>
                <button id="review-btn" class="btn-secondary px-3 py-1.5 flex items-center" onclick="window.App.openReviewPanel()">
                    Review
                    <span id="review-badge" class="review-badge hidden">0</span>
                </button>
            </div>
        </header>

        <!-- Review Panel Overlay -->
        <div id="panel-overlay" class="panel-overlay" onclick="window.App.closeReviewPanel()"></div>

        <!-- Review Panel -->
        <div id="review-panel" class="review-panel">
            <div class="review-panel-header">
                <h2 class="font-semibold" style="color: var(--text-primary); font-size: var(--text-lg);">Review</h2>
                <button onclick="window.App.closeReviewPanel()" style="color: var(--text-muted); font-size: var(--text-xl);">&times;</button>
            </div>
            <div id="review-panel-content" class="review-panel-content">
                <!-- Cards loaded dynamically -->
            </div>
            <div id="review-progress" class="review-progress hidden">
                <span id="review-current">0</span> / <span id="review-total">0</span>
            </div>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
            <!-- Left Column: Unified Input -->
            <div class="space-y-4">
                <div class="input-card p-5 h-[100%]">
                    <!-- Text Input Form -->
                    <form id="translate-form">

                        <div class="mb-4">
                            <label for="text" class="block font-medium mb-1.5" style="color: var(--text-primary); font-size: var(--text-sm);">
                                Chinese Text
                            </label>
                            <textarea
                                id="text"
                                name="text"
                                rows="5"
                                placeholder="Enter Chinese text here, e.g., 你好世界"
                                required
                                class="textarea-main w-full px-3 py-2.5 resize-y"
                            ></textarea>
                        </div>

                        <button type="submit" class="btn-primary inline-flex items-center justify-center gap-1.5 px-4 py-2 min-w-[110px]">
                            <span class="btn-text">Translate</span>
                            <span class="btn-loading hidden items-center gap-1.5">
                                <span class="spinner"></span>
                                Translating...
                            </span>
                        </button>
                    </form>

                    <!-- Divider -->
                    <div class="section-divider my-5">
                        <span>or extract from image</span>
                    </div>

                    <!-- Image Upload Form (OCR only) -->
                    <form id="ocr-form"
                          hx-post="/extract-text-html"
                          hx-target="#results"
                          hx-swap="innerHTML"
                          hx-encoding="multipart/form-data">

                        <div id="drop-zone" class="image-upload-zone p-4 text-center cursor-pointer">
                            <input type="file"
                                   id="image-input"
                                   name="file"
                                   accept=".png,.jpg,.jpeg,.webp,.gif"
                                   class="hidden">

                            <div id="upload-prompt">
                                <svg class="mx-auto h-8 w-8 mb-2" style="color: var(--text-muted);" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <p class="font-medium" style="color: var(--text-secondary); font-size: var(--text-sm);">
                                    Drop an image here or click to upload
                                </p>
                                <p class="mt-0.5" style="color: var(--text-muted); font-size: var(--text-xs);">
                                    PNG, JPG, JPEG, WebP, GIF (max 5MB)
                                </p>
                            </div>

                            <div id="preview-container" class="hidden">
                                <img id="image-preview" class="max-h-32 mx-auto rounded-md shadow-sm">
                                <p id="file-name" class="mt-2 font-medium" style="color: var(--text-primary); font-size: var(--text-sm);"></p>
                                <div class="mt-2 flex items-center justify-center gap-2">
                                    <button type="submit" class="btn-secondary px-3 py-1.5 inline-flex items-center gap-1.5">
                                        <span class="btn-text">Extract Text</span>
                                        <span class="btn-loading hidden items-center gap-1.5">
                                            <span class="spinner" style="border-color: rgba(99, 110, 114, 0.3); border-top-color: var(--text-secondary);"></span>
                                            Extracting...
                                        </span>
                                    </button>
                                    <button type="button" onclick="window.App.clearPreview()" class="hover:underline" style="color: var(--primary); font-size: var(--text-xs);">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Translation Results Table (appears below input) -->
                <div id="translation-table"></div>
            </div>

            <!-- Right Column: Job Queue / Translation Results -->
            <div class="space-y-4">
                <!-- Job Queue Panel (default view) -->
                <div id="job-queue-panel" class="input-card p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-semibold" style="color: var(--text-primary); font-size: var(--text-base);">Translation Queue</h2>
                        <span id="queue-count" class="text-xs px-2 py-0.5 rounded-full" style="background: var(--pastel-3); color: var(--text-primary);">0 jobs</span>
                    </div>
                    <div id="job-list" class="space-y-3">
                        <!-- Jobs will be rendered here -->
                        <div class="text-center py-8">
                            <p class="italic" style="color: var(--text-muted); font-size: var(--text-sm);">No translation jobs yet</p>
                            <p class="mt-1" style="color: var(--text-muted); font-size: var(--text-xs);">Submit text on the left to start</p>
                        </div>
                    </div>
                </div>

                <!-- Expanded Job View (hidden by default) -->
                <div id="expanded-job-view" class="hidden">
                    <!-- Back button -->
                    <button id="back-to-queue-btn" onclick="window.App.backToQueue()" class="mb-3 flex items-center gap-1 hover:underline" style="color: var(--primary); font-size: var(--text-sm);">
                        <span>&larr;</span> Back to Queue
                    </button>

                    <!-- Original text (read-only) -->
                    <div id="original-text-panel" class="input-card p-4 mb-4">
                        <label class="block font-medium mb-1.5" style="color: var(--text-secondary); font-size: var(--text-xs);">Original Text</label>
                        <div id="original-text-content" class="font-chinese p-2 rounded" style="background: var(--pastel-7); color: var(--text-primary); font-size: var(--text-chinese); min-height: 60px; white-space: pre-wrap;"></div>
                    </div>

                    <!-- Translation results -->
                    <div id="results" class="input-card p-5 overflow-y-auto" style="max-height: 60vh;">
                        <div class="h-full flex items-center justify-center">
                            <p class="text-center italic" style="color: var(--text-muted); font-size: var(--text-sm);">Translation results will appear here</p>
                        </div>
                    </div>

                    <!-- Mini queue preview -->
                    <div id="mini-queue-preview" class="mt-4 hidden">
                        <button onclick="window.App.backToQueue()" class="w-full input-card p-3 text-left hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between">
                                <span style="color: var(--text-secondary); font-size: var(--text-sm);">Queue</span>
                                <span id="mini-queue-count" class="text-xs px-2 py-0.5 rounded-full" style="background: var(--pastel-4); color: var(--text-primary);">0 more</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Application JavaScript - Modules (load in dependency order) -->
        <script src="/static/js/modules/utils.js"></script>
        <script src="/static/js/modules/state.js"></script>
        <script src="/static/js/modules/api.js"></script>
        <script src="/static/js/modules/srs.js"></script>
        <script src="/static/js/modules/segment-interactions.js"></script>
        <script src="/static/js/modules/translation-ui.js"></script>
        <script src="/static/js/modules/job-queue.js"></script>
        <script src="/static/js/modules/review-panel.js"></script>
        <!-- Main modules -->
        <script src="/static/js/segment-editor.js"></script>
        <script src="/static/js/app.js"></script>
    </div>
</body>
</html>
